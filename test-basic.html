<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>æ’ä»¶åŸºæœ¬åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 20px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 10px 0;
            font-size: 14px;
        }
        .test-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .test-btn:hover {
            background: #5a67d8;
        }
        .result {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            border-left: 4px solid #667eea;
        }
        .error {
            border-left-color: #dc3545;
            background: #f8d7da;
        }
        .success {
            border-left-color: #28a745;
            background: #d4edda;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª AI Translator åŸºæœ¬åŠŸèƒ½æµ‹è¯•</h1>
    
    <div class="test-section">
        <h3>ğŸ“‹ æµ‹è¯•è¯´æ˜</h3>
        <p>æ­¤é¡µé¢ç”¨äºæµ‹è¯•AIç¿»è¯‘æ’ä»¶çš„åŸºæœ¬åŠŸèƒ½ã€‚è¯·ç¡®ä¿ï¼š</p>
        <ol>
            <li>æ’ä»¶å·²æ­£ç¡®å®‰è£…å¹¶å¯ç”¨</li>
            <li>å·²åœ¨æ’ä»¶è®¾ç½®ä¸­é…ç½®API Key</li>
            <li>æ’ä»¶æƒé™è®¾ç½®æ­£ç¡®</li>
        </ol>
    </div>

    <div class="test-section">
        <h3>ğŸ”§ åŸºç¡€åŠŸèƒ½æµ‹è¯•</h3>
        <button class="test-btn" onclick="testChromeAPI()">æµ‹è¯•Chrome API</button>
        <button class="test-btn" onclick="testStorageAPI()">æµ‹è¯•å­˜å‚¨API</button>
        <button class="test-btn" onclick="testTextClassifier()">æµ‹è¯•æ–‡æœ¬åˆ†ç±»</button>
        <div id="basic-test-result"></div>
    </div>

    <div class="test-section">
        <h3>ğŸ“ æ–‡æœ¬åˆ†ç±»æµ‹è¯•</h3>
        <input type="text" class="test-input" id="test-text" placeholder="è¾“å…¥è¦æµ‹è¯•çš„æ–‡æœ¬...">
        <button class="test-btn" onclick="classifyText()">åˆ†ç±»æµ‹è¯•</button>
        <div id="classify-result"></div>
    </div>

    <div class="test-section">
        <h3>ğŸŒ å¿«é€Ÿç¿»è¯‘æµ‹è¯•</h3>
        <input type="text" class="test-input" id="quick-translate" placeholder="è¾“å…¥è¦ç¿»è¯‘çš„æ–‡æœ¬...">
        <select id="quick-lang" class="test-input" style="width: auto;">
            <option value="zh">ä¸­æ–‡</option>
            <option value="en">è‹±è¯­</option>
        </select>
        <button class="test-btn" onclick="quickTranslate()">å¿«é€Ÿç¿»è¯‘</button>
        <div id="quick-result"></div>
    </div>

    <div class="test-section">
        <h3>ğŸ“Š æµ‹è¯•ç»“æœ</h3>
        <div id="test-summary">
            <p>ç‚¹å‡»ä¸Šæ–¹æµ‹è¯•æŒ‰é’®å¼€å§‹æµ‹è¯•...</p>
        </div>
    </div>

    <script>
        let testResults = [];

        function addResult(test, status, message) {
            testResults.push({ test, status, message, timestamp: new Date() });
            updateTestSummary();
        }

        function updateTestSummary() {
            const summary = document.getElementById('test-summary');
            const passed = testResults.filter(r => r.status === 'success').length;
            const failed = testResults.filter(r => r.status === 'error').length;
            
            summary.innerHTML = `
                <h4>ğŸ“ˆ æµ‹è¯•ç»Ÿè®¡</h4>
                <p>âœ… é€šè¿‡: ${passed}</p>
                <p>âŒ å¤±è´¥: ${failed}</p>
                <p>ğŸ“Š æ€»è®¡: ${testResults.length}</p>
                <h4>ğŸ“‹ è¯¦ç»†ç»“æœ</h4>
                ${testResults.map(r => `
                    <div class="result ${r.status}">
                        <strong>${r.test}</strong> (${r.timestamp.toLocaleTimeString()})
                        <br>${r.message}
                    </div>
                `).join('')}
            `;
        }

        function testChromeAPI() {
            const result = document.getElementById('basic-test-result');
            try {
                if (typeof chrome === 'undefined') {
                    throw new Error('Chrome APIä¸å¯ç”¨');
                }
                
                if (!chrome.runtime) {
                    throw new Error('Chrome Runtime APIä¸å¯ç”¨');
                }
                
                if (!chrome.storage) {
                    throw new Error('Chrome Storage APIä¸å¯ç”¨');
                }

                result.innerHTML = '<div class="result success">âœ… Chrome API æ­£å¸¸</div>';
                addResult('Chrome APIæµ‹è¯•', 'success', 'æ‰€æœ‰å¿…éœ€çš„Chrome APIéƒ½å¯ç”¨');
            } catch (error) {
                result.innerHTML = `<div class="result error">âŒ Chrome APIé”™è¯¯: ${error.message}</div>`;
                addResult('Chrome APIæµ‹è¯•', 'error', error.message);
            }
        }

        function testStorageAPI() {
            const result = document.getElementById('basic-test-result');
            try {
                chrome.storage.sync.get(['test'], (data) => {
                    try {
                        chrome.storage.sync.set({ test: 'value' }, () => {
                            result.innerHTML = '<div class="result success">âœ… å­˜å‚¨APIæ­£å¸¸</div>';
                            addResult('å­˜å‚¨APIæµ‹è¯•', 'success', 'å­˜å‚¨è¯»å†™åŠŸèƒ½æ­£å¸¸');
                        });
                    } catch (error) {
                        result.innerHTML = `<div class="result error">âŒ å­˜å‚¨APIé”™è¯¯: ${error.message}</div>`;
                        addResult('å­˜å‚¨APIæµ‹è¯•', 'error', error.message);
                    }
                });
            } catch (error) {
                result.innerHTML = `<div class="result error">âŒ å­˜å‚¨APIé”™è¯¯: ${error.message}</div>`;
                addResult('å­˜å‚¨APIæµ‹è¯•', 'error', error.message);
            }
        }

        function testTextClassifier() {
            const result = document.getElementById('basic-test-result');
            try {
                // åˆ›å»ºä¸€ä¸ªç®€å•çš„æµ‹è¯•åˆ†ç±»å™¨
                function isChineseText(text) {
                    const chineseRegex = /[\u4e00-\u9fff]/g;
                    const chineseChars = text.match(chineseRegex);
                    const totalChars = text.replace(/\s/g, '').length;
                    return chineseChars && chineseChars.length >= totalChars * 0.6;
                }

                function isWordOrPhrase(text) {
                    const trimmed = text.trim();
                    if (!trimmed) return false;
                    
                    const sentenceEnders = /[.!?ã€‚ï¼ï¼Ÿï¼›;:ï¼š]/;
                    if (sentenceEnders.test(trimmed)) return false;
                    
                    if (!isChineseText(trimmed)) {
                        const words = trimmed.split(/\s+/);
                        if (words.length === 1) return true;
                        if (words.length <= 5 && trimmed.length < 60) return true;
                        return false;
                    }
                    
                    const cleanText = trimmed.replace(/[ï¼Œã€‚ï¼ï¼Ÿï¼›ï¼š""''ï¼ˆï¼‰ã€ã€‘ã€Šã€‹ã€]/g, '');
                    const chineseCharCount = (cleanText.match(/[\u4e00-\u9fff]/g) || []).length;
                    if (chineseCharCount >= 1 && chineseCharCount <= 8) return true;
                    if (chineseCharCount <= 15) return true;
                    return false;
                }

                // æµ‹è¯•ç”¨ä¾‹
                const tests = [
                    { text: 'hello', expected: true },
                    { text: 'ç¾ä¸½', expected: true },
                    { text: 'ç”»é¾™ç‚¹ç›', expected: true },
                    { text: 'Hello, how are you?', expected: false },
                    { text: 'ä»Šå¤©å¤©æ°”å¾ˆå¥½ã€‚', expected: false }
                ];

                let passed = 0;
                tests.forEach(test => {
                    const result = isWordOrPhrase(test.text);
                    if (result === test.expected) passed++;
                });

                if (passed === tests.length) {
                    result.innerHTML = '<div class="result success">âœ… æ–‡æœ¬åˆ†ç±»å™¨æ­£å¸¸</div>';
                    addResult('æ–‡æœ¬åˆ†ç±»å™¨æµ‹è¯•', 'success', `æ‰€æœ‰æµ‹è¯•é€šè¿‡ (${passed}/${tests.length})`);
                } else {
                    result.innerHTML = `<div class="result error">âŒ æ–‡æœ¬åˆ†ç±»å™¨å¼‚å¸¸: ${passed}/${tests.length} é€šè¿‡</div>`;
                    addResult('æ–‡æœ¬åˆ†ç±»å™¨æµ‹è¯•', 'error', `${passed}/${tests.length} é€šè¿‡`);
                }
            } catch (error) {
                result.innerHTML = `<div class="result error">âŒ æ–‡æœ¬åˆ†ç±»å™¨é”™è¯¯: ${error.message}</div>`;
                addResult('æ–‡æœ¬åˆ†ç±»å™¨æµ‹è¯•', 'error', error.message);
            }
        }

        function classifyText() {
            const text = document.getElementById('test-text').value;
            const result = document.getElementById('classify-result');
            
            if (!text.trim()) {
                result.innerHTML = '<div class="result error">âŒ è¯·è¾“å…¥æµ‹è¯•æ–‡æœ¬</div>';
                return;
            }

            try {
                function isChineseText(text) {
                    const chineseRegex = /[\u4e00-\u9fff]/g;
                    const chineseChars = text.match(chineseRegex);
                    const totalChars = text.replace(/\s/g, '').length;
                    return chineseChars && chineseChars.length >= totalChars * 0.6;
                }

                function isWordOrPhrase(text) {
                    const trimmed = text.trim();
                    if (!trimmed) return false;
                    
                    const sentenceEnders = /[.!?ã€‚ï¼ï¼Ÿï¼›;:ï¼š]/;
                    if (sentenceEnders.test(trimmed)) return false;
                    
                    if (!isChineseText(trimmed)) {
                        const words = trimmed.split(/\s+/);
                        if (words.length === 1) return true;
                        if (words.length <= 5 && trimmed.length < 60) return true;
                        return false;
                    }
                    
                    const cleanText = trimmed.replace(/[ï¼Œã€‚ï¼ï¼Ÿï¼›ï¼š""''ï¼ˆï¼‰ã€ã€‘ã€Šã€‹ã€]/g, '');
                    const chineseCharCount = (cleanText.match(/[\u4e00-\u9fff]/g) || []).length;
                    if (chineseCharCount >= 1 && chineseCharCount <= 8) return true;
                    if (chineseCharCount <= 15) return true;
                    return false;
                }

                const isWord = isWordOrPhrase(text);
                const isChinese = isChineseText(text);
                
                result.innerHTML = `
                    <div class="result success">
                        <strong>ğŸ“ æ–‡æœ¬åˆ†æç»“æœ:</strong><br>
                        æ–‡æœ¬: "${text}"<br>
                        è¯­è¨€: ${isChinese ? 'ä¸­æ–‡' : 'è‹±æ–‡'}<br>
                        ç±»å‹: ${isWord ? 'å•è¯/è¯è¯­/æˆè¯­' : 'å¥å­'}<br>
                        å­—ç¬¦æ•°: ${text.length}<br>
                        é¢„æœŸç¿»è¯‘æ¨¡å¼: ${isWord ? 'è¯¦ç»†ç¿»è¯‘' : 'ç®€åŒ–ç¿»è¯‘'}
                    </div>
                `;
            } catch (error) {
                result.innerHTML = `<div class="result error">âŒ åˆ†ç±»é”™è¯¯: ${error.message}</div>`;
            }
        }

        function quickTranslate() {
            const text = document.getElementById('quick-translate').value;
            const lang = document.getElementById('quick-lang').value;
            const result = document.getElementById('quick-result');
            
            if (!text.trim()) {
                result.innerHTML = '<div class="result error">âŒ è¯·è¾“å…¥è¦ç¿»è¯‘çš„æ–‡æœ¬</div>';
                return;
            }

            result.innerHTML = '<div class="result">ğŸ”„ ç¿»è¯‘åŠŸèƒ½éœ€è¦å®é™…çš„æ’ä»¶ç¯å¢ƒï¼Œæ­¤å¤„ä»…æµ‹è¯•æ–‡æœ¬åˆ†æ...</div>';
            
            // æ¨¡æ‹Ÿåˆ†æç»“æœ
            try {
                function isChineseText(text) {
                    const chineseRegex = /[\u4e00-\u9fff]/g;
                    const chineseChars = text.match(chineseRegex);
                    const totalChars = text.replace(/\s/g, '').length;
                    return chineseChars && chineseChars.length >= totalChars * 0.6;
                }

                function isWordOrPhrase(text) {
                    const trimmed = text.trim();
                    if (!trimmed) return false;
                    
                    const sentenceEnders = /[.!?ã€‚ï¼ï¼Ÿï¼›;:ï¼š]/;
                    if (sentenceEnders.test(trimmed)) return false;
                    
                    if (!isChineseText(trimmed)) {
                        const words = trimmed.split(/\s+/);
                        if (words.length === 1) return true;
                        if (words.length <= 5 && trimmed.length < 60) return true;
                        return false;
                    }
                    
                    const cleanText = trimmed.replace(/[ï¼Œã€‚ï¼ï¼Ÿï¼›ï¼š""''ï¼ˆï¼‰ã€ã€‘ã€Šã€‹ã€]/g, '');
                    const chineseCharCount = (cleanText.match(/[\u4e00-\u9fff]/g) || []).length;
                    if (chineseCharCount >= 1 && chineseCharCount <= 8) return true;
                    if (chineseCharCount <= 15) return true;
                    return false;
                }

                const isWord = isWordOrPhrase(text);
                const isChinese = isChineseText(text);
                
                result.innerHTML = `
                    <div class="result success">
                        <strong>ğŸ¯ ç¿»è¯‘æ¨¡å¼åˆ†æ:</strong><br>
                        æ–‡æœ¬: "${text}"<br>
                        ç›®æ ‡è¯­è¨€: ${lang === 'zh' ? 'ä¸­æ–‡' : 'è‹±æ–‡'}<br>
                        æ–‡æœ¬ç±»å‹: ${isWord ? 'å•è¯/è¯è¯­/æˆè¯­' : 'å¥å­'}<br>
                        ç¿»è¯‘æ¨¡å¼: ${isWord ? 'è¯¦ç»†ç¿»è¯‘ï¼ˆåŒ…å«è¯»éŸ³ã€è¯æ€§ã€è§£é‡Šç­‰ï¼‰' : 'ç®€åŒ–ç¿»è¯‘ï¼ˆç›´æ¥ç¿»è¯‘ç»“æœï¼‰'}
                    </div>
                `;
            } catch (error) {
                result.innerHTML = `<div class="result error">âŒ åˆ†æé”™è¯¯: ${error.message}</div>`;
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æµ‹è¯•Chrome API
        window.onload = function() {
            testChromeAPI();
        };
    </script>
</body>
</html>